<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>シフト確認</title>
</head>
<body>

<style>
    table {
        table-layout: fixed;
    }

    td > div {
        height: 100px;
        overflow: hidden;
        white-space: nowrap;
    }

</style>
<a href="{% url 'shift:index' month_previous.year month_previous.month %}">前月</a>
{{ month_current | date:"Y年m月" }}
<a href="{% url 'shift:index' month_next.year month_next.month %}">次月</a>
<table class="table">
    <thead>
    <tr>
        {% for w in week_names %}
            <th>{{ w }}</th>
        {% endfor %}
    </tr>
    </thead>
    <tbody>
    {% for week_day_shifts in shifts %}
        <tr>
            {% for day, week_shifts in week_day_shifts.items %}
                {% if now == day %}
                    <td class="table-success">
                        {% else %}
                    <td>
                {% endif %}

            <div>
                {% if month_current.month != day.month %}
                    {{ day | date:"m/d" }}
                {% else %}
                    {{ day.day }}
                {% endif %}

                {% for shift in week_shifts %}
                    {% for master_shift in shift %}
                        {% if master_shift.date.month == month_current.month %}
                            {% if master_shift.required %}
                                {% if master_shift.is_am %}
                                    {% if master_shift.worker %}
                                        <p>AM: {{ master_shift.worker.username }}</p>
                                    {% else %}
                                        <p>AM: 担当者がいません</p>
                                    {% endif %}
                                {% endif %}
                            {% else %}
                                {% if master_shift.is_am %}
                                    <p>---</p>
                                {% endif %}
                            {% endif %}
                        {% endif %}
                    {% endfor %}
                    {% for master_shift in shift %}
                        {% if master_shift.date.month == month_current.month %}
                            {% if master_shift.required %}
                                {% if master_shift.worker %}
                                        <p>PM: {{ master_shift.worker.username }}</p>
                                    {% else %}
                                        <p>PM: 担当者がいません</p>
                                    {% endif %}
                            {% else %}
                                {% if not master_shift.is_am %}
                                    <p>---</p>
                                {% endif %}
                            {% endif %}
                        {% endif %}
                    {% endfor %}
                {% endfor %}
            </div>
            </td>
            {% endfor %}
        </tr>
    {% endfor %}
    </tbody>
</table>

{% if user.is_employer %}
    <form action='{% url 'shift:employer' month_current.year month_current.month %}'>
        <input type="submit" value="雇用者用設定画面へ移行">
    </form>
{% else %}
    <form action='{% url 'shift:employee' month_current.year month_current.month%}'>
        <input type="submit" value="被雇用者用設定画面へ移行">
    </form>
{% endif %}

<form action='{% url 'shift:index' now.year now.month %}'>
    <input type="submit" value="今月({{ now.month }}月)へ戻る">
</form>

<form action='{% url 'top:index' %}'>
    <input type="submit" value="topへ戻る">
</form>

</body>
</html>